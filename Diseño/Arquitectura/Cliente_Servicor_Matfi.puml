@startuml ArquitecturaClienteServidor_MatFi

skinparam componentStyle rectangle
skinparam backgroundColor #FFFFFF
skinparam packageStyle rectangle

title Arquitectura Cliente-Servidor - MatFi\nAplicación Web con APIs REST

' ==================== CAPA CLIENTE ====================
package "CLIENTE (Navegador Web)" #E8F4F8 {
    
    component "HTML5" as html
    component "CSS3" as css
    component "JavaScript ES6+" as js
    
    package "Módulos Frontend" #F0F8FF {
        [api.js\nConsumo APIs] as apiJS
        [auth.js\nAutenticación] as authJS
        [ui.js\nManipulación DOM] as uiJS
        [state.js\nEstado app] as stateJS
        [utils.js\nUtilidades] as utilsJS
    }
    
    database "LocalStorage" as localStorage {
        [Token JWT]
        [Preferencias]
    }
}

html -[hidden]down-> apiJS
css -[hidden]down-> authJS
js -down-> apiJS
js -down-> authJS
js -down-> uiJS
authJS -down-> localStorage

' ==================== RED ====================
cloud "Internet (HTTPS/TLS)" as internet

apiJS -down-> internet : "HTTP Requests\nJSON"
internet -up-> apiJS : "HTTP Responses\nJSON"

' ==================== CAPA SERVIDOR ====================
package "SERVIDOR (Node.js + Express)" #D4E6F1 {
    
    component "Express Server\nPuerto 3000" as express
    
    package "Middleware Global" #FFCCBC {
        [CORS] as cors
        [Body Parser] as bodyParser
        [Error Handler] as errorHandler
    }
    
    package "API REST - 7 Módulos" #E1F5FE {
        
        component "1. Autenticación" as authRoutes #FFE5CC
        component "2. Usuarios" as userRoutes #D4E6F1
        component "3. Rutinas" as rutinaRoutes #C5E1A5
        component "4. Ejercicios" as ejercicioRoutes #B3E5FC
        component "5. Recetas" as recetaRoutes #FFE082
        component "6. Registros" as registroRoutes #CE93D8
        component "7. Objetivos" as progresoRoutes #FFCCBC
        
        authRoutes -[hidden]right-> userRoutes
        userRoutes -[hidden]right-> rutinaRoutes
        rutinaRoutes -[hidden]right-> ejercicioRoutes
        
        ejercicioRoutes -[hidden]down-> recetaRoutes
        recetaRoutes -[hidden]right-> registroRoutes
        registroRoutes -[hidden]right-> progresoRoutes
    }
    
    package "Controllers (MVC)" #B3E5FC {
        [authController] as authCtrl
        [usuarioController] as userCtrl
        [rutinaController] as rutCtrl
        [ejercicioController] as ejCtrl
        [recetaController] as recCtrl
        [registroController] as regCtrl
        [progresoController] as progCtrl
    }
    
    package "Middleware de Seguridad" #FFCCBC {
        [authMiddleware\nVerificar JWT] as authMW
        [validationMiddleware\nValidar datos] as valMW
    }
    
    package "Models (Acceso a Datos)" #CE93D8 {
        [Usuario.js] as userModel
        [Rutina.js] as rutModel
        [Ejercicio.js] as ejModel
        [Receta.js] as recModel
        [Entrenamiento.js] as entModel
        [Registro.js] as regModel
        [Progreso.js] as progModel
    }
    
    package "Services" #E1BEE7 {
        [authService\nBcrypt + JWT] as authSvc
        [validationService] as valSvc
    }
}

internet -down-> express
express -down-> cors
cors -down-> bodyParser

bodyParser -down-> authRoutes
bodyParser -down-> userRoutes
bodyParser -down-> rutinaRoutes

authRoutes -down-> authCtrl
userRoutes -down-> authMW
rutinaRoutes -down-> authMW
ejercicioRoutes -down-> authMW
recetaRoutes -down-> authMW
registroRoutes -down-> authMW
progresoRoutes -down-> authMW

authMW -down-> valMW

valMW -down-> userCtrl
valMW -down-> rutCtrl
valMW -down-> ejCtrl
valMW -down-> recCtrl
valMW -down-> regCtrl
valMW -down-> progCtrl

authCtrl -right-> authSvc
userCtrl -right-> valSvc

authCtrl -down-> userModel
userCtrl -down-> userModel
rutCtrl -down-> rutModel
ejCtrl -down-> ejModel
recCtrl -down-> recModel
regCtrl -down-> regModel
progCtrl -down-> progModel

' ==================== BASE DE DATOS ====================
database "MySQL Database\nmatfi_db" as mysql #FFF9C4 {
    
    package "Tablas Usuario" {
        [usuario]
        [objetivo]
        [progreso_semanal]
        [registro_agua]
    }
    
    package "Tablas Entrenamiento" {
        [nivel_entrenamiento]
        [rutina]
        [entrenamiento]
        [ejercicio]
        [entrenamiento_ejercicio]
        [usuario_rutina]
        [registro_entrenamiento]
    }
    
    package "Tablas Recetas" {
        [categoria_receta]
        [receta]
        [receta_favorita]
    }
}

userModel -down-> [usuario]
userModel -down-> [objetivo]
rutModel -down-> [rutina]
rutModel -down-> [entrenamiento]
ejModel -down-> [ejercicio]
recModel -down-> [receta]
regModel -down-> [registro_entrenamiento]
regModel -down-> [registro_agua]
progModel -down-> [progreso_semanal]

[usuario] -[hidden]right-> [nivel_entrenamiento]
[nivel_entrenamiento] -[hidden]right-> [categoria_receta]

' ==================== NOTAS ====================
note top of html
  **Cliente (Frontend)**
  • HTML5 + CSS3
  • Vanilla JavaScript ES6+
  • Fetch API para HTTP
  • LocalStorage para tokens
  • Diseño responsivo
end note

note bottom of authRoutes
  3 endpoints
  (Sin JWT)
end note

note bottom of userRoutes
  3 endpoints
  (JWT requerido)
end note

note bottom of rutinaRoutes
  4 endpoints
end note

note bottom of ejercicioRoutes
  2 endpoints
end note

note bottom of recetaRoutes
  4 endpoints
end note

note bottom of registroRoutes
  4 endpoints
end note

note bottom of progresoRoutes
  3 endpoints
end note

note top of express
  **Servidor (Backend)**
  • Node.js v18+
  • Express.js 4.x
  • Patrón MVC
  • 7 módulos de APIs REST
  • JWT para autenticación
  • Bcrypt para contraseñas
end note

note bottom of mysql
  **Base de Datos**
  • MySQL 8.0+
  • Motor InnoDB
  • UTF-8 (utf8mb4)
  • Normalizada 3NF
  • 14 tablas en total
end note

note top of authMW
  Valida JWT (módulos 2-7)
end note

' ==================== LEYENDA ====================
legend bottom
  **FLUJO DE PETICIÓN COMPLETA:**
  
  1. Usuario interactúa con HTML/JS en navegador
  2. JavaScript (api.js) hace HTTP request con Fetch
  3. Request viaja por internet vía HTTPS
  4. Express Server recibe en puerto 3000
  5. Middleware CORS permite el origen
  6. Body Parser procesa JSON
  7. Router identifica el módulo correspondiente (1-7)
  8. authMiddleware verifica JWT (módulos 2-7)
  9. validationMiddleware valida estructura de datos
  10. Controller ejecuta lógica de negocio
  11. Controller usa Services si necesita (auth, validation)
  12. Model ejecuta queries SQL en MySQL
  13. MySQL retorna resultados
  14. Model procesa y formatea datos
  15. Controller envía respuesta JSON
  16. Express retorna HTTP response
  17. JavaScript recibe y procesa JSON
  18. ui.js actualiza el DOM
  19. Usuario ve el resultado en pantalla
  
  **Stack Tecnológico:**
  Frontend: HTML5 + CSS3 + Vanilla JavaScript ES6+
  Backend: Node.js + Express.js + MySQL2 + JWT + Bcrypt
  Base de Datos: MySQL 8.0+ (14 tablas, normalizada 3NF)
  Comunicación: REST APIs con JSON sobre HTTPS
end legend

@enduml
